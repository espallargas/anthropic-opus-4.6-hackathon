/* eslint-disable react-refresh/only-export-components */
import { createContext, useContext, useState, useCallback, type ReactNode } from 'react';

export type Locale = 'pt-BR' | 'en';

interface I18nContextValue {
  locale: Locale;
  setLocale: (locale: Locale) => void;
  t: (key: string) => string;
}

const STORAGE_KEY = 'app_locale';

const dictionaries: Record<Locale, Record<string, string>> = {
  'pt-BR': {
    'app.title': 'FreePath',
    'nav.chat': 'Chat',
    'nav.admin': 'Admin',
    'nav.logo.alt': 'Logo FreePath',
    'resize.tooltip': 'Arraste para redimensionar',
    'sidebar.reconfigure': 'Reconfigurar',
    'sidebar.reconfigure.tooltip': 'Reconfigurar dados',
    'sidebar.expand': 'Expandir',
    'sidebar.collapse': 'Colapsar',
    'sidebar.language': 'Idioma',
    'chat.empty': 'Envie uma mensagem para começar.',
    'chat.placeholder': 'Digite sua mensagem...',
    'chat.stop': 'Parar (Esc)',
    'chat.send': 'Enviar',
    'chat.interrupted': '*[resposta interrompida]*',
    'setup.description':
      'Preencha seus dados para receber orientações personalizadas sobre seu processo de imigração.',
    'setup.origin': 'País de origem',
    'setup.origin.placeholder': 'Selecione seu país de origem',
    'setup.nationality': 'Nacionalidade',
    'setup.nationality.placeholder': 'Ex: Brasileira',
    'setup.destination': 'País de destino',
    'setup.destination.placeholder': 'Selecione seu país de destino',
    'setup.visa': 'Tipo de visto / objetivo',
    'setup.visa.placeholder': 'Ex: Trabalho, estudo, residência permanente',
    'setup.additional': 'Informações adicionais (opcional)',
    'setup.additional.placeholder': 'Contexto adicional que possa ajudar nas respostas...',
    'setup.submit': 'Iniciar chat',
    'setup.step.origin': 'País de origem',
    'setup.step.origin.description': 'De qual país você estará saindo?',
    'setup.step.nationalities': 'Nacionalidades',
    'setup.step.nationalities.description': 'Liste todas as suas nacionalidades atuais',
    'setup.step.destination': 'País de destino',
    'setup.step.objective': 'Objetivo',
    'setup.step.objective.description': 'Qual é o seu motivo de ida para o país de destino?',
    'setup.objective.temporary_visit': 'Visita temporária',
    'setup.objective.education': 'Educação',
    'setup.objective.work': 'Trabalho',
    'setup.objective.family_reunion': 'Reunir família',
    'setup.objective.seek_protection': 'Buscar proteção',
    'setup.objective.investments': 'Investimentos',
    'setup.objective.permanent_residence': 'Residência permanente',
    'setup.objective.other': 'Outro',
    'setup.objective.other.placeholder': 'Descreva seu objetivo...',
    'setup.next': 'Próximo',
    'setup.back': 'Voltar',
    'setup.start': 'Iniciar chat',
    'setup.search.placeholder': 'Buscar país...',
    'chat.context.nationalities': 'Nacionalidades:',
    'chat.context.from': 'De',
    'chat.context.to': 'Para',
    'tool.search_visa_requirements': 'Buscando requisitos de visto',
    'tool.check_processing_times': 'Consultando prazos de processamento',
    'sidebar.newChat': 'Novo chat',
    'sidebar.deleteChat': 'Excluir chat',
    'globe.loading': 'Carregando globo...',
    'agent.discovery_coordinator': 'Coordenador de Descoberta',
    'agent.strategy_coordinator': 'Coordenador de Estratégia',
    'agent.execution_coordinator': 'Coordenador de Execução',
    'agent.regulatory_researcher': 'Pesquisador Regulatório',
    'agent.pathway_strategist': 'Estrategista de Percurso',
    'agent.eligibility_analyst': 'Analista de Elegibilidade',
    'agent.documentation_specialist': 'Especialista em Documentação',
    'agent.application_manager': 'Gerente de Aplicação',
    'agent.unknown': 'Agente',
    'agent.analyzing': 'Analisando...',
    'usage.label': 'Tokens utilizados',
    'thinking.active': 'Pensando...',
    'thinking.done': 'Raciocínio concluído',
    'admin.header.title': 'Legislação Admin',
    'admin.header.description': 'Gerenciar legislação por país',
    'admin.section.active': 'Ativo',
    'admin.section.pending': 'Pendente',
    'admin.country_item.updated': 'atualizado',
    'admin.country_item.view_legislations': 'Ver legislações',
    'admin.country_item.refresh_legislation': 'Atualizar legislação',
    'admin.units.doc': 'doc',
    'admin.units.docs': 'docs',
    'admin.units.legislation': 'legislação',
    'admin.units.legislations': 'legislações',
    'admin.crawl.loading': 'Carregando...',
    'admin.crawl.error': 'Erro ao carregar países',
    'admin.crawl.retry': 'Tentar novamente',
    'admin.crawl.no_countries': 'Nenhum país disponível',
    'admin.crawl.pause': 'Pausar rastreamento',
    'admin.crawl.close': 'Fechar',
    'admin.crawl.starting': 'Iniciando rastreamento...',
    'admin.crawl.complete': '✓ Rastreamento completo',
    'admin.crawl.documents_saved': 'documentos salvos',
    'admin.crawl.stop_confirm': 'Parar rastreamento?',
    'admin.crawl.stop_description':
      'O progresso será descartado. Todos os dados são salvos apenas no final.',
    'admin.crawl.stop_cancel': 'Cancelar',
    'admin.crawl.stop_confirm_button': 'Parar e Fechar',
    'admin.categories.title': 'Categorias',
    'admin.categories.searching': 'Pesquisando...',
    'admin.categories.results_crawled': 'resultados web rastreados',
    'admin.categories.parsed': 'legislações analisadas',
    'admin.thinking.title': 'Pensando',
    'admin.thinking.waiting': 'Aguardando Claude pensar...',
    'admin.thinking.tokens': 'Tokens:',
    'admin.output.title': 'Saída do Claude',
    'admin.output.waiting': 'Aguardando saída do Claude...',
    'admin.legislation_panel.loading': 'Carregando...',
    'admin.legislation_panel.empty': 'Sem legislações',
    'admin.category.federal_laws': 'Leis Federais',
    'admin.category.federal_laws.description': 'Leis constitucionais & principais',
    'admin.category.regulations': 'Regulamentos',
    'admin.category.regulations.description': 'Procedimentos oficiais',
    'admin.category.consular': 'Regras Consulares',
    'admin.category.consular.description': 'Visto & embaixadas',
    'admin.category.jurisdictional': 'Jurisdicional',
    'admin.category.jurisdictional.description': 'Regras regionais',
    'admin.category.complementary': 'Saúde & Complementar',
    'admin.category.complementary.description': 'Requisitos de saúde',
    'admin.category.auxiliary': 'Auxiliar',
    'admin.category.auxiliary.description': 'Estatísticas & quotas',
    'admin.crawl.tokens': 'tokens',
    'admin.crawl.parsing': 'analisando',
    'admin.crawl.found': 'encontrado',
    'admin.crawl.searching': 'Procurando',
    'admin.crawl.documents_indexed': 'documentos indexados',
    'admin.thinking.adaptive': 'Adaptativo',
    'admin.thinking.high_effort': 'Alto esforço',
    'admin.crawl.more': 'mais',
    'legislation.source': 'Fonte',
    'legislation.deprecated': 'Descontinuada',
    'usage.tokens_short': 'tok',
    'countries.us': 'Estados Unidos',
    'countries.br': 'Brasil',
    'countries.de': 'Alemanha',
    'countries.fr': 'França',
    'countries.gb': 'Reino Unido',
    'countries.ca': 'Canadá',
    'countries.au': 'Austrália',
    'countries.jp': 'Japão',
    'countries.cn': 'China',
    'countries.in': 'Índia',
    'countries.mx': 'México',
    'countries.es': 'Espanha',
    'countries.it': 'Itália',
    'countries.nl': 'Holanda',
    'countries.se': 'Suécia',
    'countries.ch': 'Suíça',
    'countries.at': 'Áustria',
    'countries.be': 'Bélgica',
    'countries.gr': 'Grécia',
    'countries.pt': 'Portugal',
    'countries.nz': 'Nova Zelândia',
    'countries.sg': 'Singapura',
    'countries.hk': 'Hong Kong',
    'countries.kr': 'Coreia do Sul',
    'countries.th': 'Tailândia',
    'countries.ph': 'Filipinas',
    'countries.my': 'Malásia',
    'countries.id': 'Indonésia',
    'countries.vn': 'Vietnã',
    'countries.ar': 'Argentina',
    'countries.cl': 'Chile',
    'countries.co': 'Colômbia',
    'countries.pe': 'Peru',
    'countries.za': 'África do Sul',
    'countries.eg': 'Egito',
    'countries.ng': 'Nigéria',
    'countries.ke': 'Quênia',
    'countries.ae': 'Emirados Árabes Unidos',
    'countries.sa': 'Arábia Saudita',
    'countries.il': 'Israel',
    'countries.tr': 'Turquia',
    'countries.ru': 'Rússia',
    'countries.ua': 'Ucrânia',
    'countries.pl': 'Polônia',
    'countries.cz': 'República Tcheca',
    'countries.hu': 'Hungria',
    'countries.ro': 'Romênia',
    'countries.bg': 'Bulgária',
    'countries.hr': 'Croácia',
    'countries.ie': 'Irlanda',
    'countries.dk': 'Dinamarca',
    'countries.fi': 'Finlândia',
    'countries.no': 'Noruega',
    'countries.is': 'Islândia',
    'countries.lv': 'Letônia',
    'countries.lt': 'Lituânia',
    'countries.ee': 'Estônia',
    'countries.sk': 'Eslováquia',
    'countries.si': 'Eslovênia',
    'countries.mt': 'Malta',
    'countries.cy': 'Chipre',
    'countries.lu': 'Luxemburgo',
    'countries.kz': 'Cazaquistão',
    'countries.ge': 'Geórgia',
    'countries.az': 'Azerbaijão',
    'countries.am': 'Armênia',
    'countries.pk': 'Paquistão',
    'countries.bd': 'Bangladesh',
    'countries.lk': 'Sri Lanka',
    'countries.np': 'Nepal',
    'countries.kh': 'Camboja',
    'countries.la': 'Laos',
    'countries.mm': 'Mianmar',
    'countries.tw': 'Taiwan',
    'countries.mz': 'Moçambique',
    'countries.tz': 'Tanzânia',
    'countries.ug': 'Uganda',
    'countries.gh': 'Gana',
    'countries.sn': 'Senegal',
    'countries.ci': 'Costa do Marfim',
    'countries.tn': 'Tunísia',
    'countries.dz': 'Argélia',
    'countries.ma': 'Marrocos',
    'countries.jo': 'Jordânia',
    'countries.lb': 'Líbano',
    'countries.kw': 'Kuwait',
    'countries.qa': 'Catar',
    'countries.bh': 'Bahrein',
    'countries.om': 'Omã',
    'countries.ye': 'Iêmen',
    'countries.ir': 'Irã',
    'countries.af': 'Afeganistão',
    'countries.iq': 'Iraque',
    'countries.sy': 'Síria',
    'countries.ve': 'Venezuela',
    'countries.ec': 'Equador',
    'countries.bo': 'Bolívia',
    'countries.py': 'Paraguai',
    'countries.uy': 'Uruguai',
    'countries.cr': 'Costa Rica',
    'countries.pa': 'Panamá',
    'countries.do': 'República Dominicana',
    'countries.cu': 'Cuba',
    'countries.jm': 'Jamaica',
    'countries.tt': 'Trinidad e Tobago',
    'countries.bb': 'Barbados',
    'countries.gy': 'Guiana',
    'countries.sr': 'Surinã',
    'countries.bz': 'Belize',
    'countries.sv': 'El Salvador',
    'countries.gt': 'Guatemala',
    'countries.hn': 'Honduras',
    'countries.ni': 'Nicarágua',
    'countries.fj': 'Fiji',
  },
  en: {
    'app.title': 'FreePath',
    'nav.chat': 'Chat',
    'nav.admin': 'Admin',
    'nav.logo.alt': 'FreePath Logo',
    'resize.tooltip': 'Drag to resize',
    'sidebar.reconfigure': 'Reconfigure',
    'sidebar.reconfigure.tooltip': 'Reconfigure data',
    'sidebar.expand': 'Expand',
    'sidebar.collapse': 'Collapse',
    'sidebar.language': 'Language',
    'chat.empty': 'Send a message to get started.',
    'chat.placeholder': 'Type your message...',
    'chat.stop': 'Stop (Esc)',
    'chat.send': 'Send',
    'chat.interrupted': '*[response interrupted]*',
    'setup.description':
      'Fill in your details to receive personalized guidance on your immigration process.',
    'setup.origin': 'Country of origin',
    'setup.origin.placeholder': 'Select your country of origin',
    'setup.nationality': 'Nationality',
    'setup.nationality.placeholder': 'Ex: Brazilian',
    'setup.destination': 'Destination country',
    'setup.destination.placeholder': 'Select your destination country',
    'setup.visa': 'Visa type / objective',
    'setup.visa.placeholder': 'Ex: Work, study, permanent residence',
    'setup.additional': 'Additional information (optional)',
    'setup.additional.placeholder': 'Additional context that may help...',
    'setup.submit': 'Start chat',
    'setup.step.origin': 'Country of origin',
    'setup.step.origin.description': 'Which country will you be departing from?',
    'setup.step.nationalities': 'Nationalities',
    'setup.step.nationalities.description': 'List all your current nationalities',
    'setup.step.destination': 'Destination country',
    'setup.step.objective': 'Objective',
    'setup.step.objective.description': 'What is your reason for going to the destination country?',
    'setup.objective.temporary_visit': 'Temporary visit',
    'setup.objective.education': 'Education',
    'setup.objective.work': 'Work',
    'setup.objective.family_reunion': 'Family reunion',
    'setup.objective.seek_protection': 'Seek protection',
    'setup.objective.investments': 'Investments',
    'setup.objective.permanent_residence': 'Permanent residence',
    'setup.objective.other': 'Other',
    'setup.objective.other.placeholder': 'Describe your objective...',
    'setup.next': 'Next',
    'setup.back': 'Back',
    'setup.start': 'Start chat',
    'setup.search.placeholder': 'Search country...',
    'chat.context.nationalities': 'Nationalities:',
    'chat.context.from': 'From',
    'chat.context.to': 'To',
    'tool.search_visa_requirements': 'Searching visa requirements',
    'tool.check_processing_times': 'Checking processing times',
    'sidebar.newChat': 'New chat',
    'sidebar.deleteChat': 'Delete chat',
    'globe.loading': 'Loading globe...',
    'agent.discovery_coordinator': 'Discovery Coordinator',
    'agent.strategy_coordinator': 'Strategy Coordinator',
    'agent.execution_coordinator': 'Execution Coordinator',
    'agent.regulatory_researcher': 'Regulatory Researcher',
    'agent.pathway_strategist': 'Pathway Strategist',
    'agent.eligibility_analyst': 'Eligibility Analyst',
    'agent.documentation_specialist': 'Documentation Specialist',
    'agent.application_manager': 'Application Manager',
    'agent.unknown': 'Agent',
    'agent.analyzing': 'Analyzing...',
    'thinking.active': 'Thinking...',
    'thinking.done': 'Reasoning complete',
    'usage.label': 'Tokens used',
    'admin.header.title': 'Legislation Admin',
    'admin.header.description': 'Manage country legislation',
    'admin.section.active': 'Active',
    'admin.section.pending': 'Pending',
    'admin.country_item.updated': 'updated',
    'admin.country_item.view_legislations': 'View legislations',
    'admin.country_item.refresh_legislation': 'Refresh legislation',
    'admin.units.doc': 'doc',
    'admin.units.docs': 'docs',
    'admin.units.legislation': 'legislation',
    'admin.units.legislations': 'legislations',
    'admin.crawl.loading': 'Loading...',
    'admin.crawl.error': 'Error loading countries',
    'admin.crawl.retry': 'Retry',
    'admin.crawl.no_countries': 'No countries available',
    'admin.crawl.pause': 'Pause crawl',
    'admin.crawl.close': 'Close',
    'admin.crawl.starting': 'Starting crawl...',
    'admin.crawl.complete': '✓ Crawl complete',
    'admin.crawl.documents_saved': 'documents saved',
    'admin.crawl.searching': 'Searching',
    'admin.crawl.documents_indexed': 'documents indexed',
    'admin.crawl.stop_confirm': 'Stop crawl?',
    'admin.crawl.stop_description':
      'Progress will be discarded. All data is only saved at the end.',
    'admin.crawl.stop_cancel': 'Cancel',
    'admin.crawl.stop_confirm_button': 'Stop & Close',
    'admin.categories.title': 'Categories',
    'admin.categories.searching': 'Searching...',
    'admin.categories.results_crawled': 'web results crawled',
    'admin.categories.parsed': 'legislations parsed',
    'admin.thinking.title': 'Thinking',
    'admin.thinking.waiting': 'Waiting for Claude to think...',
    'admin.thinking.tokens': 'Tokens:',
    'admin.output.title': 'Claude Output',
    'admin.output.waiting': 'Waiting for Claude output...',
    'admin.legislation_panel.loading': 'Loading...',
    'admin.legislation_panel.empty': 'No legislations',
    'admin.category.federal_laws': 'Federal Laws',
    'admin.category.federal_laws.description': 'Constitutional & main laws',
    'admin.category.regulations': 'Regulations',
    'admin.category.regulations.description': 'Official procedures',
    'admin.category.consular': 'Consular Rules',
    'admin.category.consular.description': 'Visa & embassies',
    'admin.category.jurisdictional': 'Jurisdictional',
    'admin.category.jurisdictional.description': 'Regional rules',
    'admin.category.complementary': 'Health & Complementary',
    'admin.category.complementary.description': 'Health requirements',
    'admin.category.auxiliary': 'Auxiliary',
    'admin.category.auxiliary.description': 'Statistics & quotas',
    'admin.crawl.tokens': 'tokens',
    'admin.crawl.parsing': 'parsing',
    'admin.crawl.found': 'found',
    'admin.thinking.adaptive': 'Adaptive',
    'admin.thinking.high_effort': 'High effort',
    'admin.crawl.more': 'more',
    'legislation.source': 'Source',
    'legislation.deprecated': 'Deprecated',
    'usage.tokens_short': 'tok',
    'countries.us': 'United States',
    'countries.br': 'Brazil',
    'countries.de': 'Germany',
    'countries.fr': 'France',
    'countries.gb': 'United Kingdom',
    'countries.ca': 'Canada',
    'countries.au': 'Australia',
    'countries.jp': 'Japan',
    'countries.cn': 'China',
    'countries.in': 'India',
    'countries.mx': 'Mexico',
    'countries.es': 'Spain',
    'countries.it': 'Italy',
    'countries.nl': 'Netherlands',
    'countries.se': 'Sweden',
    'countries.ch': 'Switzerland',
    'countries.at': 'Austria',
    'countries.be': 'Belgium',
    'countries.gr': 'Greece',
    'countries.pt': 'Portugal',
    'countries.nz': 'New Zealand',
    'countries.sg': 'Singapore',
    'countries.hk': 'Hong Kong',
    'countries.kr': 'South Korea',
    'countries.th': 'Thailand',
    'countries.ph': 'Philippines',
    'countries.my': 'Malaysia',
    'countries.id': 'Indonesia',
    'countries.vn': 'Vietnam',
    'countries.ar': 'Argentina',
    'countries.cl': 'Chile',
    'countries.co': 'Colombia',
    'countries.pe': 'Peru',
    'countries.za': 'South Africa',
    'countries.eg': 'Egypt',
    'countries.ng': 'Nigeria',
    'countries.ke': 'Kenya',
    'countries.ae': 'United Arab Emirates',
    'countries.sa': 'Saudi Arabia',
    'countries.il': 'Israel',
    'countries.tr': 'Turkey',
    'countries.ru': 'Russia',
    'countries.ua': 'Ukraine',
    'countries.pl': 'Poland',
    'countries.cz': 'Czech Republic',
    'countries.hu': 'Hungary',
    'countries.ro': 'Romania',
    'countries.bg': 'Bulgaria',
    'countries.hr': 'Croatia',
    'countries.ie': 'Ireland',
    'countries.dk': 'Denmark',
    'countries.fi': 'Finland',
    'countries.no': 'Norway',
    'countries.is': 'Iceland',
    'countries.lv': 'Latvia',
    'countries.lt': 'Lithuania',
    'countries.ee': 'Estonia',
    'countries.sk': 'Slovakia',
    'countries.si': 'Slovenia',
    'countries.mt': 'Malta',
    'countries.cy': 'Cyprus',
    'countries.lu': 'Luxembourg',
    'countries.kz': 'Kazakhstan',
    'countries.ge': 'Georgia',
    'countries.az': 'Azerbaijan',
    'countries.am': 'Armenia',
    'countries.pk': 'Pakistan',
    'countries.bd': 'Bangladesh',
    'countries.lk': 'Sri Lanka',
    'countries.np': 'Nepal',
    'countries.kh': 'Cambodia',
    'countries.la': 'Laos',
    'countries.mm': 'Myanmar',
    'countries.tw': 'Taiwan',
    'countries.mz': 'Mozambique',
    'countries.tz': 'Tanzania',
    'countries.ug': 'Uganda',
    'countries.gh': 'Ghana',
    'countries.sn': 'Senegal',
    'countries.ci': "Côte d'Ivoire",
    'countries.tn': 'Tunisia',
    'countries.dz': 'Algeria',
    'countries.ma': 'Morocco',
    'countries.jo': 'Jordan',
    'countries.lb': 'Lebanon',
    'countries.kw': 'Kuwait',
    'countries.qa': 'Qatar',
    'countries.bh': 'Bahrain',
    'countries.om': 'Oman',
    'countries.ye': 'Yemen',
    'countries.ir': 'Iran',
    'countries.af': 'Afghanistan',
    'countries.iq': 'Iraq',
    'countries.sy': 'Syria',
    'countries.ve': 'Venezuela',
    'countries.ec': 'Ecuador',
    'countries.bo': 'Bolivia',
    'countries.py': 'Paraguay',
    'countries.uy': 'Uruguay',
    'countries.cr': 'Costa Rica',
    'countries.pa': 'Panama',
    'countries.do': 'Dominican Republic',
    'countries.cu': 'Cuba',
    'countries.jm': 'Jamaica',
    'countries.tt': 'Trinidad and Tobago',
    'countries.bb': 'Barbados',
    'countries.gy': 'Guyana',
    'countries.sr': 'Suriname',
    'countries.bz': 'Belize',
    'countries.sv': 'El Salvador',
    'countries.gt': 'Guatemala',
    'countries.hn': 'Honduras',
    'countries.ni': 'Nicaragua',
    'countries.fj': 'Fiji',
  },
};

function loadLocale(): Locale {
  try {
    const stored = localStorage.getItem(STORAGE_KEY);
    if (stored === 'pt-BR' || stored === 'en') return stored;
  } catch {
    // ignore
  }
  return 'pt-BR';
}

const I18nContext = createContext<I18nContextValue | null>(null);

export function I18nProvider({ children }: { children: ReactNode }) {
  const [locale, setLocaleState] = useState<Locale>(loadLocale);

  const setLocale = useCallback((newLocale: Locale) => {
    setLocaleState(newLocale);
    try {
      localStorage.setItem(STORAGE_KEY, newLocale);
    } catch {
      // ignore
    }
  }, []);

  const t = useCallback((key: string) => dictionaries[locale][key] ?? key, [locale]);

  return <I18nContext value={{ locale, setLocale, t }}>{children}</I18nContext>;
}

export function useI18n() {
  const ctx = useContext(I18nContext);
  if (!ctx) throw new Error('useI18n must be used within I18nProvider');
  return ctx;
}
